"use strict";

function wrapper(my) {
    var output, header = my.header;
    if (my.custom) output = String(my.custom); else {
        output = my.signature;
        var version = process.version.match(/[0-9]{1,2}/g);
        if (my.Major && (output += "/" + version[0], my.Minor && (output += "." + version[1], 
        my.Min && (output += "." + version[2], my.OS)))) {
            var os = require("os");
            output += " (" + os.type() + ")";
        }
    }
    if (my.extra && (output += " " + String(my.extra)), my.standalone) return function() {
        return output;
    };
    var setHeader = require("setheaders").setWritableHeader;
    return function(req, res, next) {
        return setHeader(res, header, output), next();
    };
}

function signature(opt) {
    var options = opt || Object.create(null), my = {
        header: String(options.header || "Server"),
        signature: String(options.signature || "Nodejs"),
        token: String(options.token || "Full"),
        custom: options.custom,
        extra: options.extra,
        standalone: Boolean(options.standalone)
    };
    return "Full" == my.token ? my.Prod = my.Major = my.Minor = my.Min = my.OS = !0 : "OS" == my.token ? my.Prod = my.Major = my.Minor = my.Min = my.OS = !0 : "Min" == my.token ? my.Prod = my.Major = my.Minor = my.Min = !0 : "Minor" == my.token ? my.Prod = my.Major = my.Minor = !0 : "Major" == my.token ? my.Prod = my.Major = !0 : "Prod" == my.token && (my.Prod = !0), 
    wrapper(my);
}

module.exports = signature;
